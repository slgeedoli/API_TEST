<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì¹´ì¹´ì˜¤ë§µ ê¸¸ì°¾ê¸° - ìµœì¢… ìˆ˜ì •ë³¸</title>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; padding: 20px; line-height: 1.6; }
        .container { max-width: 800px; margin: 0 auto; }
        .search-box { background: #f9f9f9; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .input-group { display: flex; align-items: center; gap: 8px; margin-bottom: 10px; }
        label { width: 60px; font-weight: bold; }
        input { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
        button { padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .btn-search { background-color: #333; color: white; }
        .btn-location { background-color: #4CAF50; color: white; }
        .btn-path { width: 100%; background-color: #FEE500; color: #3c1e1e; font-size: 1.1em; margin-top: 10px; }
        #map { width: 100%; height: 450px; margin-top: 20px; border-radius: 10px; border: 1px solid #ccc; }
        .result-text { font-size: 13px; margin-left: 68px; margin-bottom: 10px; color: #666; min-height: 20px; }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ“ ì¹´ì¹´ì˜¤ë§µ ê¸¸ì°¾ê¸°</h2>
    <div class="search-box">
        <div class="input-group">
            <label>ì¶œë°œì§€</label>
            <input type="text" id="startKeyword" placeholder="ì¥ì†Œ ê²€ìƒ‰ ë˜ëŠ” ë‚´ ìœ„ì¹˜ í´ë¦­" 
                   onkeydown="if(event.keyCode==13) searchLocation('start')">
            <button type="button" class="btn-search" onclick="searchLocation('start')">ê²€ìƒ‰</button>
            <button type="button" class="btn-location" onclick="setToCurrentLocation()">ğŸ“ ë‚´ ìœ„ì¹˜</button>
        </div>
        <div id="startResult" class="result-text"></div>

        <div class="input-group">
            <label>ë„ì°©ì§€</label>
            <input type="text" id="endKeyword" placeholder="ë„ì°©ì§€ ê²€ìƒ‰" 
                   onkeydown="if(event.keyCode==13) searchLocation('end')">
            <button type="button" class="btn-search" onclick="searchLocation('end')">ê²€ìƒ‰</button>
        </div>
        <div id="endResult" class="result-text"></div>

        <button type="button" class="btn-path" onclick="openPathFinding()">ğŸš€ ì¹´ì¹´ì˜¤ë§µ ê¸¸ì°¾ê¸° ì‹œì‘</button>
    </div>
    <div id="map"></div>
</div>

<script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=66ae3efe79b3a691f03832967f0df6a2&libraries=services,clusterer,drawing&autoload=false"></script>

<script>
// 1. ì „ì—­ ë³€ìˆ˜ ì„ ì–¸ (ì´ˆê¸°ê°’ ì„¤ì •)
var map, ps, geocoder;
var startPoint = { lat: null, lng: null, name: null, marker: null, overlay: null };
var endPoint = { lat: null, lng: null, name: null, marker: null, overlay: null };
var polyline = null;

// 2. ì§€ë„ ì´ˆê¸°í™”
kakao.maps.load(function() {
    var mapContainer = document.getElementById('map');
    var mapOption = {
        center: new kakao.maps.LatLng(37.566826, 126.9786567),
        level: 3
    };
    map = new kakao.maps.Map(mapContainer, mapOption);
    ps = new kakao.maps.services.Places();
    geocoder = new kakao.maps.services.Geocoder();
});

// 3. ê²€ìƒ‰ í•¨ìˆ˜
function searchLocation(type) {
    var keyword = document.getElementById(type + 'Keyword').value;
    if (!keyword.trim()) {
        alert('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
    }

    ps.keywordSearch(keyword, function(data, status) {
        if (status === kakao.maps.services.Status.OK) {
            var place = data[0];
            setPoint(type, place.y, place.x, place.place_name);
        } else {
            alert('ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.');
        }
    });
}

// 4. ë‚´ ìœ„ì¹˜ í•¨ìˆ˜
function setToCurrentLocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
            var lat = position.coords.latitude;
            var lng = position.coords.longitude;
            geocoder.coord2Address(lng, lat, function(result, status) {
                if (status === kakao.maps.services.Status.OK) {
                    var addr = result[0].address.address_name;
                    document.getElementById('startKeyword').value = "ë‚´ í˜„ì¬ ìœ„ì¹˜";
                    setPoint('start', lat, lng, "ë‚´ í˜„ì¬ ìœ„ì¹˜ (" + addr + ")");
                }
            });
        }, function(err) {
            alert("ìœ„ì¹˜ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”.");
        });
    }
}

// 5. ë§ˆì»¤ ë° ì˜¤ë²„ë ˆì´ í‘œì‹œ (í•µì‹¬ ìˆ˜ì • ë¶€ë¶„)
function setPoint(type, lat, lng, name) {
    var pos = new kakao.maps.LatLng(lat, lng);
    var target = (type === 'start') ? startPoint : endPoint;

    // ê¸°ì¡´ ìš”ì†Œ ì œê±°
    if (target.marker) target.marker.setMap(null);
    if (target.overlay) target.overlay.setMap(null);

    var bgColor = (type === 'start') ? '#007aff' : '#ff3b30';
    var labelText = (type === 'start') ? 'ì¶œë°œ' : 'ë„ì°©';

    // ì»¤ìŠ¤í…€ ì˜¤ë²„ë ˆì´ (ë§í’ì„ )
    var content = '<div style="position: relative; bottom: 45px; transform: translateX(-50%); z-index:10;">' +
                  '  <div style="padding: 5px 12px; background: ' + bgColor + '; border-radius: 4px; color: #fff; font-weight: bold; font-size: 13px; box-shadow: 0 2px 6px rgba(0,0,0,0.3); border: 1px solid #fff; white-space: nowrap;">' + labelText + '</div>' +
                  '  <div style="position: absolute; width: 0; height: 0; border-left: 6px solid transparent; border-right: 6px solid transparent; border-top: 8px solid ' + bgColor + '; bottom: -7px; left: 50%; transform: translateX(-50%);"></div>' +
                  '</div>';

    target.overlay = new kakao.maps.CustomOverlay({ position: pos, content: content, map: map });
    target.marker = new kakao.maps.Marker({ position: pos, map: map });
    
    target.lat = lat; target.lng = lng; target.name = name;

    // ê²°ê³¼ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
    var resultId = (type === 'start') ? 'startResult' : 'endResult';
    document.getElementById(resultId).innerHTML = "<b style='color:" + bgColor + ";'>â— " + labelText + ":</b> " + name;

    // ë‘ ì§€ì  ì—°ê²° ë° ë²”ìœ„ ì¡°ì •
    if (startPoint.lat && endPoint.lat) {
        if (polyline) polyline.setMap(null);
        polyline = new kakao.maps.Polyline({
            path: [new kakao.maps.LatLng(startPoint.lat, startPoint.lng), new kakao.maps.LatLng(endPoint.lat, endPoint.lng)],
            strokeWeight: 5, strokeColor: '#db4040', strokeOpacity: 0.7
        });
        polyline.setMap(map);

        var bounds = new kakao.maps.LatLngBounds();
        bounds.extend(new kakao.maps.LatLng(startPoint.lat, startPoint.lng));
        bounds.extend(new kakao.maps.LatLng(endPoint.lat, endPoint.lng));
        map.setBounds(bounds, 50);
    } else {
        map.panTo(pos);
    }
}

// 6. ê¸¸ì°¾ê¸° ì‹¤í–‰
function openPathFinding() {
    if (!startPoint.lat || !endPoint.lat) {
        alert("ì¶œë°œì§€ì™€ ë„ì°©ì§€ë¥¼ ëª¨ë‘ ì„¤ì •í•´ì£¼ì„¸ìš”.");
        return;
    }
    var url = "https://map.kakao.com/link/to/" + endPoint.name + "," + endPoint.lat + "," + endPoint.lng + 
              "/from/" + startPoint.name + "," + startPoint.lat + "," + startPoint.lng;
    window.open(url, '_blank');
}
</script>
</body>
</html>
