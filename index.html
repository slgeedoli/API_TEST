<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì¹´ì¹´ì˜¤ë§µ ê¸¸ì°¾ê¸° ìµœì¢…</title>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; padding: 20px; line-height: 1.6; }
        .container { max-width: 800px; margin: 0 auto; }
        .search-box { background: #f9f9f9; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .input-group { display: flex; align-items: center; gap: 8px; margin-bottom: 10px; }
        label { width: 60px; font-weight: bold; }
        input { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
        button { padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .btn-search { background-color: #333; color: white; }
        .btn-location { background-color: #4CAF50; color: white; }
        .btn-path { width: 100%; background-color: #FEE500; color: #3c1e1e; font-size: 1.1em; margin-top: 10px; }
        #map { width: 100%; height: 450px; margin-top: 20px; border-radius: 10px; border: 1px solid #ccc; }
        .result-text { font-size: 13px; margin-left: 68px; margin-bottom: 10px; color: #666; }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ“ ì¹´ì¹´ì˜¤ë§µ ê¸¸ì°¾ê¸°</h2>
    <div class="search-box">
        <div class="input-group">
    <label>ì¶œë°œì§€</label>
    <input type="text" id="startKeyword" placeholder="ì¥ì†Œ ê²€ìƒ‰ ë˜ëŠ” ë‚´ ìœ„ì¹˜ í´ë¦­" 
           onkeyup="if(window.event.keyCode==13){searchLocation('start')}">
    <button class="btn-search" onclick="searchLocation('start')">ê²€ìƒ‰</button>
    <button class="btn-location" onclick="setToCurrentLocation()">ğŸ“ ë‚´ ìœ„ì¹˜</button>
</div>

<div class="input-group">
    <label>ë„ì°©ì§€</label>
    <input type="text" id="endKeyword" placeholder="ë„ì°©ì§€ ê²€ìƒ‰" 
           onkeyup="if(window.event.keyCode==13){searchLocation('end')}">
    <button class="btn-search" onclick="searchLocation('end')">ê²€ìƒ‰</button>
</div>
        <button class="btn-path" onclick="openPathFinding()">ğŸš€ ì¹´ì¹´ì˜¤ë§µ ê¸¸ì°¾ê¸° ì‹œì‘</button>
    </div>
    <div id="map"></div>
</div>

<script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=66ae3efe79b3a691f03832967f0df6a2&libraries=services,clusterer,drawing&autoload=false"></script>

<script>
// ì „ì—­ ë³€ìˆ˜ ì„¤ì •
var map, ps, geocoder;
var startPoint = { lat: null, lng: null, name: null, marker: null };
var endPoint = { lat: null, lng: null, name: null, marker: null };
var polyline = null;

// ì¹´ì¹´ì˜¤ ì§€ë„ SDK ë¡œë“œ ë³´ì¥
kakao.maps.load(function() {
    var mapContainer = document.getElementById('map');
    var mapOption = {
        center: new kakao.maps.LatLng(37.566826, 126.9786567),
        level: 3
    };
    map = new kakao.maps.Map(mapContainer, mapOption);
    ps = new kakao.maps.services.Places();
    geocoder = new kakao.maps.services.Geocoder();
});

// [ê¸°ëŠ¥] í‚¤ì›Œë“œ ê²€ìƒ‰
function searchLocation(type) {
    var keyword = document.getElementById(type + 'Keyword').value;
    if (!keyword.trim()) {
        alert('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
    }

    ps.keywordSearch(keyword, function(data, status) {
        if (status === kakao.maps.services.Status.OK) {
            var place = data[0];
            setPoint(type, place.y, place.x, place.place_name);
        } else {
            alert('ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.');
        }
    });
}

// [ê¸°ëŠ¥] ë‚´ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°
function setToCurrentLocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
            var lat = position.coords.latitude;
            var lng = position.coords.longitude;
            
            geocoder.coord2Address(lng, lat, function(result, status) {
                if (status === kakao.maps.services.Status.OK) {
                    var addr = result[0].address.address_name;
                    document.getElementById('startKeyword').value = "ë‚´ í˜„ì¬ ìœ„ì¹˜";
                    setPoint('start', lat, lng, "ë‚´ í˜„ì¬ ìœ„ì¹˜ (" + addr + ")");
                }
            });
        }, function(err) {
            alert("ìœ„ì¹˜ ì •ë³´ ì ‘ê·¼ì„ í—ˆìš©í•´ì£¼ì„¸ìš”.");
        });
    } else {
        alert("ì´ ë¸Œë¼ìš°ì €ëŠ” ìœ„ì¹˜ ê¸°ëŠ¥ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
    }
}

// [ê³µí†µ] ë§ˆì»¤ ë° ì„  ê·¸ë¦¬ê¸°
// [ì™„ë²½í•˜ê²Œ êµì •ëœ ë§ˆì»¤ í‘œì‹œ í•¨ìˆ˜]
// [ì¶œë°œ: íŒŒë‘, ë„ì°©: ë¹¨ê°•ìœ¼ë¡œ ì„¤ì •ëœ ë§ˆì»¤ í‘œì‹œ í•¨ìˆ˜]
// ì „ì—­ ë³€ìˆ˜ì— ì˜¤ë²„ë ˆì´ ì €ì¥ ë³€ìˆ˜ ì¶”ê°€ (ê¸°ì¡´ ë³€ìˆ˜ë“¤ê³¼ í•¨ê»˜ ì„ ì–¸)
// ì „ì—­ ë³€ìˆ˜ ì˜ì—­ì— ì˜¤ë²„ë ˆì´ ê´€ë¦¬ ë³€ìˆ˜ ì¶”ê°€
var startOverlay = null;
var endOverlay = null;

function setPoint(type, lat, lng, name) {
    var pos = new kakao.maps.LatLng(lat, lng);
    
    // 1. ê¸°ì¡´ ë§ˆì»¤ ë° ì˜¤ë²„ë ˆì´ ì œê±° (ì¤‘ë³µ ë°©ì§€)
    if (type === 'start') {
        if (startPoint.marker) startPoint.marker.setMap(null);
        if (startOverlay) startOverlay.setMap(null);
    } else {
        if (endPoint.marker) endPoint.marker.setMap(null);
        if (endOverlay) endOverlay.setMap(null);
    }

    // 2. ğŸ¨ ë””ìì¸ ì„¤ì • (ì´ë¯¸ì§€ ëŒ€ì‹  ì½”ë“œë¡œ ìƒì„±)
    var bgColor = (type === 'start') ? '#007aff' : '#ff3b30'; // ì¶œë°œ: íŒŒë‘, ë„ì°©: ë¹¨ê°•
    var labelText = (type === 'start') ? 'ì¶œë°œ' : 'ë„ì°©';

    // HTML ì½”ë“œë¡œ ì§ì ‘ ë§í’ì„  ì œì‘
    var content = 
        '<div style="position: relative; bottom: 45px; transform: translateX(-50%);">' +
        '  <div style="padding: 5px 12px; background: ' + bgColor + '; border-radius: 4px; color: #fff; font-weight: bold; font-size: 13px; box-shadow: 0 2px 6px rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.2); white-space: nowrap;">' +
             labelText +
        '  </div>' +
        '  <div style="position: absolute; width: 0; height: 0; border-left: 6px solid transparent; border-right: 6px solid transparent; border-top: 8px solid ' + bgColor + '; bottom: -7px; left: 50%; transform: translateX(-50%);"></div>' +
        '</div>';

    // 3. ì»¤ìŠ¤í…€ ì˜¤ë²„ë ˆì´ ìƒì„±
    var customOverlay = new kakao.maps.CustomOverlay({
        position: pos,
        content: content,
        map: map
    });

    // 4. ìœ„ì¹˜ í‘œì‹œìš© ê¸°ë³¸ ë§ˆì»¤ (ì‘ì€ ì  í˜¹ì€ í•€)
    var newMarker = new kakao.maps.Marker({
        position: pos,
        map: map
    });

    // 5. ë°ì´í„° ì—…ë°ì´íŠ¸
    if (type === 'start') {
        startPoint = { lat: lat, lng: lng, name: name, marker: newMarker };
        startOverlay = customOverlay;
        document.getElementById('startResult').innerHTML = "<b style='color:#007aff;'>ğŸŸ¦ ì¶œë°œì§€:</b> " + name;
    } else {
        endPoint = { lat: lat, lng: lng, name: name, marker: newMarker };
        endOverlay = customOverlay;
        document.getElementById('endResult').innerHTML = "<b style='color:#ff3b30;'>ğŸŸ¥ ë„ì°©ì§€:</b> " + name;
    }

    // 6. ì§€ë„ ë²”ìœ„ ì¡°ì • ë¡œì§ (ê¸°ì¡´ê³¼ ë™ì¼)
    if (startPoint.lat && endPoint.lat) {
        if (polyline) polyline.setMap(null);
        polyline = new kakao.maps.Polyline({
            path: [new kakao.maps.LatLng(startPoint.lat, startPoint.lng), new kakao.maps.LatLng(endPoint.lat, endPoint.lng)],
            strokeWeight: 5, strokeColor: '#db4040', strokeOpacity: 0.7
        });
        polyline.setMap(map);
        var bounds = new kakao.maps.LatLngBounds();
        bounds.extend(new kakao.maps.LatLng(startPoint.lat, startPoint.lng));
        bounds.extend(new kakao.maps.LatLng(endPoint.lat, endPoint.lng));
        map.setBounds(bounds, 50);
    } else {
        map.panTo(pos);
    }
}

// [ê¸°ëŠ¥] ì¹´ì¹´ì˜¤ë§µ ì—°ë™
function openPathFinding() {
if (!startPoint.lat || !endPoint.lat) {
        alert("ì¶œë°œì§€ì™€ ë„ì°©ì§€ë¥¼ ëª¨ë‘ ì„¤ì •í•´ì£¼ì„¸ìš”.");
        return;
    }

    // 1. ë„ì°©ì§€ ì •ë³´ (To)
    var toName = endPoint.name;
    var toLat = endPoint.lat;
    var toLng = endPoint.lng;

    // 2. ì¶œë°œì§€ ì •ë³´ (From)
    var fromName = startPoint.name;
    var fromLat = startPoint.lat;
    var fromLng = startPoint.lng;

    // 3. ìµœì¢… URL ì¡°í•© (ìˆœì„œ: /to/ë„ì°©ì§€/from/ì¶œë°œì§€)
    var url = "https://map.kakao.com/link/to/" + toName + "," + toLat + "," + toLng + 
              "/from/" + fromName + "," + fromLat + "," + fromLng;

    window.open(url, '_blank');
}
</script>

</body>
</html>










