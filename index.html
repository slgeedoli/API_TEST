<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì¹´ì¹´ì˜¤ë§µ ê¸¸ì°¾ê¸° êµ¬í˜„</title>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; margin: 0; padding: 20px; }
        
        /* ì…ë ¥ í¼ ìŠ¤íƒ€ì¼ */
        .search-box { margin-bottom: 10px; padding: 10px; background: #f5f5f5; border-radius: 5px; }
        input { padding: 8px; width: 200px; border: 1px solid #ccc; }
        button { padding: 8px 15px; cursor: pointer; background-color: #ddd; border: none; }
        button.primary { background-color: #FEE500; font-weight: bold; } /* ì¹´ì¹´ì˜¤ ë…¸ë€ìƒ‰ */
        
        /* ìƒíƒœ í‘œì‹œ í…ìŠ¤íŠ¸ */
        #status { margin: 10px 0; font-size: 14px; color: #555; }

        /* ì§€ë„ í¬ê¸° */
        #map { width: 100%; height: 500px; border: 1px solid #ddd; margin-top: 10px;}
    </style>
</head>
<body>

    <h2>ğŸ—ºï¸ ì¹´ì¹´ì˜¤ë§µ ê¸¸ì°¾ê¸°</h2>

    <div class="search-box">
        <label>ğŸ ì¶œë°œì§€:</label>
        <input type="text" id="startKeyword" placeholder="ì˜ˆ: ì„œìš¸ì—­" onkeypress="if(event.keyCode==13) searchLocation('start')">
        <button onclick="searchLocation('start')">ê²€ìƒ‰</button>
        <span id="startResult" style="color:blue; font-weight:bold; margin-left:10px;">(ë¯¸ì„¤ì •)</span>
    </div>

    <div class="search-box">
        <label>ğŸš© ë„ì°©ì§€:</label>
        <input type="text" id="endKeyword" placeholder="ì˜ˆ: ë¶€ì‚°ì—­" onkeypress="if(event.keyCode==13) searchLocation('end')">
        <button onclick="searchLocation('end')">ê²€ìƒ‰</button>
        <span id="endResult" style="color:red; font-weight:bold; margin-left:10px;">(ë¯¸ì„¤ì •)</span>
    </div>

    <button class="primary" onclick="openPathFinding()">ğŸš€ ê¸¸ì°¾ê¸° ì‹œì‘</button>
    
    <div id="status">ì¶œë°œì§€ì™€ ë„ì°©ì§€ë¥¼ ê²€ìƒ‰í•˜ì—¬ ì„¤ì •í•´ì£¼ì„¸ìš”.</div>
    <div id="map"></div>

    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=66ae3efe79b3a691f03832967f0df6a2&libraries=services"></script>
    
    <script>
        // 1. ì§€ë„ ìƒì„±
        var mapContainer = document.getElementById('map'),
            mapOption = {
                center: new kakao.maps.LatLng(37.566826, 126.9786567),
                level: 3
            };
        var map = new kakao.maps.Map(mapContainer, mapOption);
        
        // ì¥ì†Œ ê²€ìƒ‰ ê°ì²´
        var ps = new kakao.maps.services.Places();

        // ì „ì—­ ë³€ìˆ˜ë¡œ ì¶œë°œì§€/ë„ì°©ì§€ ë°ì´í„° ì €ì¥
        var startPoint = { marker: null, lat: null, lng: null, name: null };
        var endPoint = { marker: null, lat: null, lng: null, name: null };
        var polyline = null; // ë‘ ì§€ì ì„ ì‡ëŠ” ì„ 

        // 2. í†µí•© ê²€ìƒ‰ í•¨ìˆ˜ (type: 'start' or 'end')
        function searchLocation(type) {
            var keywordId = type + 'Keyword';
            var keyword = document.getElementById(keywordId).value;

            if (!keyword.replace(/^\s+|\s+$/g, '')) {
                alert('ì¥ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return false;
            }

            // ê²€ìƒ‰ ì‹¤í–‰
            ps.keywordSearch(keyword, function(data, status) {
                placesSearchCB(data, status, type);
            });
        }

        // 3. ê²€ìƒ‰ ì½œë°± í•¨ìˆ˜
        function placesSearchCB(data, status, type) {
            if (status === kakao.maps.services.Status.OK) {
                var place = data[0]; // ì²« ë²ˆì§¸ ê²€ìƒ‰ ê²°ê³¼ ì‚¬ìš©
                var lat = place.y;
                var lng = place.x;
                var name = place.place_name;

                // ë§ˆì»¤ ìƒì„± ë° ê¸°ì¡´ ë§ˆì»¤ ì œê±° ë¡œì§
                setPoint(type, lat, lng, name);

                // ì§€ë„ ë²”ìœ„ ì¬ì„¤ì • (ë‘ ì ì´ ë‹¤ ë³´ ì´ë„ë¡)
                setBounds();

            } else if (status === kakao.maps.services.Status.ZERO_RESULT) {
                alert('ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.');
            } else {
                alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // 4. ì§€ì  ì„¤ì • ë° ë§ˆì»¤ í‘œì‹œ
        function setPoint(type, lat, lng, name) {
            var locPosition = new kakao.maps.LatLng(lat, lng);
            
            // ë§ˆì»¤ ì´ë¯¸ì§€ ì„¤ì • (ì¶œë°œ:íŒŒë‘, ë„ì°©:ë¹¨ê°•)
            var imageSrc = type === 'start' 
                ? "https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/blue_b.png" 
                : "https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/red_b.png"; 
            var imageSize = new kakao.maps.Size(50, 45); 
            var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize);

            // í•´ë‹¹ íƒ€ì…(start/end) ê°ì²´ ê°€ì ¸ì˜¤ê¸°
            var pointObj = (type === 'start') ? startPoint : endPoint;

            // ê¸°ì¡´ ë§ˆì»¤ê°€ ìˆë‹¤ë©´ ì œê±°
            if (pointObj.marker) pointObj.marker.setMap(null);

            // ìƒˆ ë§ˆì»¤ ìƒì„±
            var marker = new kakao.maps.Marker({  
                map: map, 
                position: locPosition,
                image: markerImage 
            });

            // ë°ì´í„° ì €ì¥
            pointObj.marker = marker;
            pointObj.lat = lat;
            pointObj.lng = lng;
            pointObj.name = name;

            // UI í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
            document.getElementById(type + 'Result').innerText = name;
            document.getElementById('status').innerText = type === 'start' ? "ë„ì°©ì§€ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”." : "ê¸¸ì°¾ê¸° ë²„íŠ¼ì„ ëˆŒëŸ¬ë³´ì„¸ìš”.";

            // ë‘ ì§€ì ì´ ëª¨ë‘ ì„¤ì •ë˜ì—ˆìœ¼ë©´ ì„  ê·¸ë¦¬ê¸°
            drawPolyline();
        }

        // 5. ë‘ ì§€ì  ì‚¬ì´ ì§ì„  ê·¸ë¦¬ê¸° (ì‹œê°ì  í™•ì¸ìš©)
        function drawPolyline() {
            if (polyline) polyline.setMap(null); // ê¸°ì¡´ ì„  ì œê±°

            if (startPoint.lat && endPoint.lat) {
                var linePath = [
                    new kakao.maps.LatLng(startPoint.lat, startPoint.lng),
                    new kakao.maps.LatLng(endPoint.lat, endPoint.lng)
                ];

                polyline = new kakao.maps.Polyline({
                    path: linePath,
                    strokeWeight: 5,
                    strokeColor: '#db4040',
                    strokeOpacity: 0.7,
                    strokeStyle: 'solid'
                });

                polyline.setMap(map);
            }
        }

        // 6. ì§€ë„ ë²”ìœ„ ì¬ì„¤ì • (ì¶œë°œì§€, ë„ì°©ì§€ê°€ ë‹¤ ë³´ì´ê²Œ)
        function setBounds() {
            var bounds = new kakao.maps.LatLngBounds();
            
            if (startPoint.lat) bounds.extend(new kakao.maps.LatLng(startPoint.lat, startPoint.lng));
            if (endPoint.lat) bounds.extend(new kakao.maps.LatLng(endPoint.lat, endPoint.lng));

            if (!startPoint.lat && !endPoint.lat) return; // ë‘˜ ë‹¤ ì—†ìœ¼ë©´ ë¦¬í„´
            
            map.setBounds(bounds);
        }

        // 7. [í•µì‹¬] ì‹¤ì œ ê¸¸ì°¾ê¸° ì—°ê²° (ì¹´ì¹´ì˜¤ë§µ URL Scheme ì‚¬ìš©)
        function openPathFinding() {
            if (!startPoint.lat || !endPoint.lat) {
                alert("ì¶œë°œì§€ì™€ ë„ì°©ì§€ë¥¼ ëª¨ë‘ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤!");
                return;
            }

            // ì¹´ì¹´ì˜¤ë§µ ê¸¸ì°¾ê¸° URL í˜•ì‹
            // https://map.kakao.com/link/to/ë„ì°©ì§€ëª…,ë„ì°©ìœ„ë„,ë„ì°©ê²½ë„/from/ì¶œë°œì§€ëª…,ì¶œë°œìœ„ë„,ì¶œë°œê²½ë„
            var url = 'https://map.kakao.com/link/to/' + 
                      endPoint.name + ',' + endPoint.lat + ',' + endPoint.lng + 
                      '/from/' + 
                      startPoint.name + ',' + startPoint.lat + ',' + startPoint.lng;

            window.open(url, '_blank'); // ìƒˆ íƒ­ì—ì„œ ì—´ê¸°
        }
    </script>
</body>
</html>

